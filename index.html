<!DOCTYPE html>
<html>
<head>
<title>Visualization of shit</title>
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script src="/circularHeatChart.js" charset="utf-8"></script>
<script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
<script src="http://underscorejs.org/underscore-min.js"></script>

<style>
body {
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
	margin: 2%;
}

#wrapper{width:1500;overflow: hidden;}
#nation{width:1000px; height:700px; float:left; fill:#ccc;}
#mostFreqColors{overflow:hidden;}

</style>
</head>

<body>

<div id="dataviztest"></div>
<div id="wrapper">
	<div id="nation"></div>
	<div id="mostFreqColors"></div>
</div>

<script type="text/javascript">

// Testing data structure's visualization

cities = ["boston", "chicago", "dc", "houston", "la", "minneapolis", "seattle"]

var data = {}

$(function() {
    // Load the data for all cities into a dictionary
    _.each(cities, function(city) {
        data[city] = {}
        _.each(_.range(1, 13), function(month) {
            month_string = month < 10 ? "0" + month : month;
            date = "2011-" + month_string + "-01";
            month_path = "imageanalysis/out/" + city + "/" + date + ".json"

            $.getJSON(month_path, function(json) {
                data[city][month] = json;
            });
        });
    });

});



d3.json("./imageanalysis/out/boston/2011-01-01.json", function(json){
    var hue_data =[];
    var tot_hue_perc = 0;

	// gets the reference data and makes the comparison target thing
	for (var hue in json.ref_aggregate.hues){
		hue_data.push([hue, 1 - tot_hue_perc]); // 0: is hue, 1: is percentage ref_hue occurs
		tot_hue_perc += json.ref_aggregate.hues[hue]["percentage"];
	};

	// gets average color for every aggregated hue
	for (var hue in json.aggregate.hues){
		var avg_light = json.aggregate["hues"][hue]["total_light"] / json.aggregate["hues"][hue]["count"];
		var avg_sat = json.aggregate["hues"][hue]["total_sat"] / json.aggregate["hues"][hue]["count"];
	};

    var svg = d3.select("#dataviztest").append("svg")
        .attr("width", 600)
        .attr("height", 600);

    var g = svg.selectAll("g")
        .data(hue_data)
    .enter().append("g")
        .attr("transform", "translate(" + [200, 200] + ")");

    g.append("circle")
        .attr("cx", 10)
        .attr("cy", 10)
        .attr("r", 100)
        .attr("transform", function(d) { 
            scaling_factor = d[1];
            transform_factor = -(10 * scaling_factor - 1)

            // Translates and scales the circles so that they're concentric
            translate = "translate(" + transform_factor + "," + transform_factor + ")";
            scale =  "scale(" + d[1]+ ")"; 

            return translate + " " +  scale
        })
        .attr("fill", function(d) { return d3.hsl(d[0], 1, 0.5) });

});




// nation visualization
var path = d3.geo.path();

var svg = d3.select("#nation").append("svg")
    .attr("width", 960)
    .attr("height", 500);

d3.json("/us.json", function(error, topology) {
  svg.append("path")
      .datum(topojson.feature(topology, topology.objects.land))
      .attr("d", path);
});


// This is a modified version of the circular heat chart at http://prcweb.co.uk/lab/circularheat/
var chart_data = [];

for(var i=0; i<(5*12); i++) chart_data[i] = Math.random();

var chart = circularHeatChart()
    .innerRadius(20)
    .range(["white", "#cca"])
    .radialLabels(["Boston", "Chicago", "Houston", "Los Angeles", "Seattle"])
    .segmentLabels(["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sept", "Oct", "Nov", "Dec"]);

d3.select('#mostFreqColors')
    .selectAll('svg')
    .data([chart_data])
    .enter()
    .append('svg')
    .call(chart);

</script>
</body>
</html>

